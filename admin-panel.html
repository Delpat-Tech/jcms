<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JCMS Admin Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #2c3e50; color: white; padding: 20px; text-align: center; margin-bottom: 30px; }
        .auth-section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .section h2 { color: #2c3e50; margin-bottom: 15px; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        .route-group { margin-bottom: 20px; }
        .route-group h3 { color: #34495e; margin-bottom: 10px; }
        .route { display: flex; align-items: center; margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .method { padding: 4px 8px; border-radius: 4px; color: white; font-weight: bold; margin-right: 10px; min-width: 60px; text-align: center; }
        .get { background: #28a745; }
        .post { background: #007bff; }
        .put { background: #ffc107; color: #000; }
        .delete { background: #dc3545; }
        .endpoint { flex: 1; font-family: monospace; }
        .description { color: #666; font-size: 14px; margin-left: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .btn { padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #2980b9; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .token-display { background: #e8f5e9; padding: 10px; border-radius: 4px; margin-top: 10px; word-break: break-all; }
        .response { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 10px; border-left: 4px solid #3498db; }
        .error { border-left-color: #e74c3c; background: #fdf2f2; }
        .success { border-left-color: #27ae60; background: #f0f9f0; }
        .hidden { display: none; }
        .test-form { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 10px; }
        .test-form input, .test-form select { margin-bottom: 10px; }
        .tabs { display: flex; background: #34495e; margin-bottom: 0; }
        .tab { padding: 15px 25px; background: #34495e; color: white; cursor: pointer; border: none; }
        .tab.active { background: #3498db; }
        .tab:hover { background: #2980b9; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>JCMS Admin Panel</h1>
            <p>Comprehensive API Testing Interface</p>
            <div style="background: #e74c3c; color: white; padding: 10px; margin-top: 10px; border-radius: 4px;">
                <strong>‚ö†Ô∏è IMPORTANT:</strong> Access this panel through the server, not as a file!
                <br><strong>‚úÖ Correct way:</strong> Start server with <code style="background: rgba(255,255,255,0.2); padding: 2px 4px; border-radius: 2px;">npm run dev</code> then go to <code style="background: rgba(255,255,255,0.2); padding: 2px 4px; border-radius: 2px;">http://localhost:5000/admin</code>
                <br><strong>‚ùå Wrong way:</strong> Opening the HTML file directly in browser
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('auth')">üîê Authentication</button>
            <button class="tab" onclick="showTab('images')">üñºÔ∏è Images</button>
            <button class="tab" onclick="showTab('users')">üë• Users</button>
            <button class="tab" onclick="showTab('files')">üìÅ Files</button>
            <button class="tab" onclick="showTab('analytics')">üìä Analytics</button>
            <button class="tab" onclick="showTab('notifications')">üîî Notifications</button>
            <button class="tab" onclick="showTab('tenants')">üè¢ Tenants</button>
        </div>

        <!-- Authentication Tab -->
        <div id="auth-tab" class="tab-content active">
            <div class="section">
                <h2>üîê Authentication & Connection</h2>
                <div class="form-group">
                    <button class="btn" onclick="testConnection()" style="background: #27ae60;">üîç Test Server Connection</button>
                    <div id="connectionStatus" class="response hidden"></div>
                <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; font-size: 14px;">
                    <strong>üìã Setup Steps:</strong><br>
                    1. Open terminal in JCMS folder<br>
                    2. Run: <code>npm run dev</code><br>
                    3. Wait for "Server started successfully" message<br>
                    4. Go to: <code>http://localhost:5000/admin</code><br>
                    5. Click "Test Server Connection" above<br>
                    <br>
                    <strong>Server Base URL:</strong>
                    <input id="serverUrlInput" type="text" placeholder="http://localhost:5000" style="width: 70%; padding: 6px; margin-top: 6px;"/>
                    <button class="btn" style="margin-left: 6px;" onclick="setBaseURLFromInput()">Save</button>
                    <div style="margin-top: 6px; font-size: 13px; color: #555;">
                        Current: <span id="currentServerUrl"></span>
                    </div>
                </div>
                </div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="username" placeholder="Enter username">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="password" placeholder="Enter password">
                </div>
                <button class="btn" onclick="login()">Login</button>
                <button class="btn btn-danger" onclick="logout()">Logout</button>
                <div id="tokenDisplay" class="token-display hidden"></div>
                
                <div class="route-group" style="margin-top: 20px;">
                    <h3>System Health</h3>
                    <div class="route">
                        <span class="method get">GET</span>
                        <span class="endpoint">/api/health</span>
                        <button class="btn" onclick="testRoute('GET', '/api/health')">Test</button>
                    </div>
                    <div id="health-response" class="response hidden"></div>
                </div>
            </div>
        </div>

        <!-- Images Tab -->
        <div id="images-tab" class="tab-content">
            <div class="section">
                <h2>üñºÔ∏è Images Management</h2>
            <div class="route-group">
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/images</span>
                    <span class="description">Get all images (supports ?own=true)</span>
                    <button class="btn" onclick="testRoute('GET', '/api/images')">Test</button>
                </div>
                <div class="route">
                    <span class="method post">POST</span>
                    <span class="endpoint">/api/images</span>
                    <span class="description">Upload new image</span>
                    <button class="btn" onclick="showImageUpload()">Test</button>
                </div>
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/images/:id</span>
                    <span class="description">Get specific image</span>
                    <button class="btn" onclick="showImageById()">Test</button>
                </div>
                <div class="route">
                    <span class="method put">PUT</span>
                    <span class="endpoint">/api/images/:id</span>
                    <span class="description">Update image (simple)</span>
                    <button class="btn" onclick="showImageUpdate()">Test</button>
                </div>
                <div class="route">
                    <span class="method" style="background: #17a2b8; color: white;">PATCH</span>
                    <span class="endpoint">/api/images/:id</span>
                    <span class="description">Update image (advanced with format conversion)</span>
                    <button class="btn" onclick="showImageUpdate()">Test</button>
                </div>
                <div class="route">
                    <span class="method delete">DELETE</span>
                    <span class="endpoint">/api/images/:id</span>
                    <span class="description">Delete image</span>
                    <button class="btn" onclick="showImageDelete()">Test</button>
                </div>
            </div>
                <div id="images-forms" class="hidden"></div>
                <div id="images-response" class="response hidden"></div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="users-tab" class="tab-content">
            <div class="section">
                <h2>üë• User Management</h2>
            <div class="route-group">
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/users</span>
                    <span class="description">Get all users</span>
                    <button class="btn" onclick="testRoute('GET', '/api/users')">Test</button>
                </div>
                <div class="route">
                    <span class="method post">POST</span>
                    <span class="endpoint">/api/users</span>
                    <span class="description">Create new user</span>
                    <button class="btn" onclick="showUserCreate()">Test</button>
                </div>
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/users/:id</span>
                    <span class="description">Get specific user</span>
                    <button class="btn" onclick="showUserById()">Test</button>
                </div>
                <div class="route">
                    <span class="method put">PUT</span>
                    <span class="endpoint">/api/users/:id</span>
                    <span class="description">Update user</span>
                    <button class="btn" onclick="showUserUpdate()">Test</button>
                </div>
                <div class="route">
                    <span class="method delete">DELETE</span>
                    <span class="endpoint">/api/users/:id</span>
                    <span class="description">Delete user</span>
                    <button class="btn" onclick="showUserDelete()">Test</button>
                </div>
            </div>
                <div id="users-forms" class="hidden"></div>
                <div id="users-response" class="response hidden"></div>
            </div>
        </div>

        <!-- Files Tab -->
        <div id="files-tab" class="tab-content">
            <div class="section">
                <h2>üìÅ File Management</h2>
            <div class="route-group">
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/files</span>
                    <span class="description">Get all files</span>
                    <button class="btn" onclick="testRoute('GET', '/api/files')">Test</button>
                </div>
                <div class="route">
                    <span class="method post">POST</span>
                    <span class="endpoint">/api/files</span>
                    <span class="description">Upload file</span>
                    <button class="btn" onclick="showFileUpload()">Test</button>
                </div>
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/files/:id</span>
                    <span class="description">Get specific file</span>
                    <button class="btn" onclick="showFileById()">Test</button>
                </div>
                <div class="route">
                    <span class="method delete">DELETE</span>
                    <span class="endpoint">/api/files/:id</span>
                    <span class="description">Delete file</span>
                    <button class="btn" onclick="showFileDelete()">Test</button>
                </div>
            </div>
                <div id="files-forms" class="hidden"></div>
                <div id="files-response" class="response hidden"></div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content">
            <div class="section">
                <h2>üìä Analytics</h2>
            <div class="route-group">
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/analytics/dashboard</span>
                    <span class="description">Get dashboard analytics</span>
                    <button class="btn" onclick="testRoute('GET', '/api/analytics/dashboard')">Test</button>
                </div>
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/analytics/activity</span>
                    <span class="description">Get activity logs</span>
                    <button class="btn" onclick="testRoute('GET', '/api/analytics/activity')">Test</button>
                </div>
            </div>
                <div id="analytics-response" class="response hidden"></div>
            </div>
        </div>

        <!-- Notifications Tab -->
        <div id="notifications-tab" class="tab-content">
            <div class="section">
                <h2>üîî Notifications</h2>
            <div class="route-group">
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/notifications</span>
                    <span class="description">Get notifications</span>
                    <button class="btn" onclick="testRoute('GET', '/api/notifications')">Test</button>
                </div>
                <div class="route">
                    <span class="method post">POST</span>
                    <span class="endpoint">/api/test-notification</span>
                    <span class="description">Send test notification</span>
                    <button class="btn" onclick="testRoute('POST', '/api/test-notification', {message: 'Test from admin panel'})">Test</button>
                </div>
            </div>
                <div id="notifications-response" class="response hidden"></div>
            </div>
        </div>

        <!-- Tenants Tab -->
        <div id="tenants-tab" class="tab-content">
            <div class="section">
                <h2>üè¢ Tenant Management</h2>
            <div class="route-group">
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/tenants</span>
                    <span class="description">Get all tenants</span>
                    <button class="btn" onclick="testRoute('GET', '/api/tenants')">Test</button>
                </div>
                <div class="route">
                    <span class="method post">POST</span>
                    <span class="endpoint">/api/tenants</span>
                    <span class="description">Create tenant</span>
                    <button class="btn" onclick="showTenantCreate()">Test</button>
                </div>
                <div class="route">
                    <span class="method get">GET</span>
                    <span class="endpoint">/api/tenants/:id</span>
                    <span class="description">Get specific tenant</span>
                    <button class="btn" onclick="showTenantById()">Test</button>
                </div>
            </div>
                <div id="tenants-forms" class="hidden"></div>
                <div id="tenants-response" class="response hidden"></div>
            </div>
        </div>
    </div>

    <script>
        let authToken = localStorage.getItem('jcms_token') || '';
        // Configurable server base URL with sensible defaults
        const DEFAULT_BASE_URL = 'http://localhost:5000';
        function deriveDefaultBaseURL() {
            try {
                const origin = window.location.origin;
                if (origin.startsWith('file://')) return DEFAULT_BASE_URL;
                const u = new URL(origin);
                if (u.port && u.port !== '5000') return DEFAULT_BASE_URL;
                return origin;
            } catch (_) {
                return DEFAULT_BASE_URL;
            }
        }
        let baseURL = localStorage.getItem('jcms_base_url') || deriveDefaultBaseURL();

        function setBaseURLFromInput() {
            const input = document.getElementById('serverUrlInput');
            if (!input) return;
            const value = input.value.trim();
            if (!value) return;
            baseURL = value.replace(/\/$/, '');
            localStorage.setItem('jcms_base_url', baseURL);
            const el = document.getElementById('currentServerUrl');
            if (el) el.textContent = baseURL + ' (saved)';
            alert('Server URL updated to: ' + baseURL);
        }

        // Update token display on load
        if (authToken) {
            document.getElementById('tokenDisplay').innerHTML = `<strong>Token:</strong> ${authToken}`;
            document.getElementById('tokenDisplay').classList.remove('hidden');
        }
        
        // Initialize server URL UI
        (function initServerUrlUI() {
            const input = document.getElementById('serverUrlInput');
            const label = document.getElementById('currentServerUrl');
            if (input) input.value = baseURL;
            if (label) label.textContent = baseURL;
            if (window.location.origin.startsWith('file://')) {
                label.style.color = 'orange';
                label.innerHTML += ' <strong>(Note: Opened as file:// ‚Äî browser may block cross-origin requests)</strong>';
            }
        })();

        async function testConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.innerHTML = 'Testing connection...';
            statusDiv.className = 'response';
            statusDiv.classList.remove('hidden');
            
            try {
                const response = await fetch(`${baseURL}/api/health`);
                const data = await response.json();
                
                statusDiv.innerHTML = `
                    <strong>‚úÖ Server Connected!</strong><br>
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Response:</strong> ${data.message}<br>
                    <strong>Server URL:</strong> ${baseURL}
                `;
                statusDiv.className = 'response success';
            } catch (error) {
                statusDiv.innerHTML = `
                    <strong>‚ùå Connection Failed!</strong><br>
                    <strong>Error:</strong> ${error.message}<br>
                    <strong>Server URL:</strong> ${baseURL}<br>
                    <strong>üîß Solutions:</strong><br>
                    1. Open terminal in your JCMS project folder<br>
                    2. Run: <code>npm run dev</code> or <code>npm start</code><br>
                    3. Wait for "Server started successfully" message<br>
                    4. Make sure port 5000 is not blocked<br>
                    5. Try refreshing this page after server starts
                `;
                statusDiv.className = 'response error';
            }
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }

            try {
                console.log('Attempting login to:', `${baseURL}/api/auth/login`);
                const response = await fetch(`${baseURL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success && data.token) {
                    authToken = data.token;
                    localStorage.setItem('jcms_token', authToken);
                    document.getElementById('tokenDisplay').innerHTML = `<strong>Token:</strong> ${authToken}<br><strong>User:</strong> ${data.user.username} (${data.user.role})`;
                    document.getElementById('tokenDisplay').classList.remove('hidden');
                    alert('Login successful!');
                } else {
                    alert('Login failed: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login error: ' + error.message + '\n\nMake sure the server is running on ' + baseURL);
            }
        }

        function logout() {
            authToken = '';
            localStorage.removeItem('jcms_token');
            document.getElementById('tokenDisplay').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            alert('Logged out successfully');
        }

        async function testRoute(method, endpoint, body = null) {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    ...(authToken && { 'Authorization': `Bearer ${authToken}` })
                }
            };

            if (body && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(`${baseURL}${endpoint}`, options);
                const data = await response.json();
                
                const responseDiv = getResponseDiv(endpoint);
                responseDiv.innerHTML = `
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Response:</strong><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                responseDiv.className = `response ${response.ok ? 'success' : 'error'}`;
                responseDiv.classList.remove('hidden');
            } catch (error) {
                const responseDiv = getResponseDiv(endpoint);
                responseDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                responseDiv.className = 'response error';
                responseDiv.classList.remove('hidden');
            }
        }

        function getResponseDiv(endpoint) {
            if (endpoint.includes('/images')) return document.getElementById('images-response');
            if (endpoint.includes('/users')) return document.getElementById('users-response');
            if (endpoint.includes('/files')) return document.getElementById('files-response');
            if (endpoint.includes('/analytics')) return document.getElementById('analytics-response');
            if (endpoint.includes('/notifications')) return document.getElementById('notifications-response');
            if (endpoint.includes('/tenants')) return document.getElementById('tenants-response');
            if (endpoint.includes('/health')) return document.getElementById('health-response');
            return document.getElementById('health-response');
        }

        function showImageUpload() {
            const formsDiv = document.getElementById('images-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Upload Image</h4>
                    <input type="text" id="imageTitle" placeholder="Image title" required>
                    <input type="file" id="imageFile" accept="image/*" required>
                    <select id="imageFormat">
                        <option value="webp">WebP</option>
                        <option value="avif">AVIF</option>
                        <option value="jpeg">JPEG</option>
                        <option value="png">PNG</option>
                    </select>
                    <button class="btn" onclick="uploadImage()">Upload</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        async function uploadImage() {
            const title = document.getElementById('imageTitle').value;
            const file = document.getElementById('imageFile').files[0];
            const format = document.getElementById('imageFormat').value;

            if (!title || !file) {
                alert('Please provide title and select a file');
                return;
            }

            const formData = new FormData();
            formData.append('title', title);
            formData.append('image', file);
            formData.append('format', format);

            try {
                const response = await fetch(`${baseURL}/api/images`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: formData
                });

                const data = await response.json();
                const responseDiv = document.getElementById('images-response');
                responseDiv.innerHTML = `
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Response:</strong><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                responseDiv.className = `response ${response.ok ? 'success' : 'error'}`;
                responseDiv.classList.remove('hidden');
            } catch (error) {
                alert('Upload error: ' + error.message);
            }
        }

        function showImageById() {
            const formsDiv = document.getElementById('images-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Get Image by ID</h4>
                    <input type="text" id="imageId" placeholder="Image ID" required>
                    <button class="btn" onclick="getImageById()">Get Image</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function getImageById() {
            const id = document.getElementById('imageId').value;
            if (!id) {
                alert('Please enter image ID');
                return;
            }
            testRoute('GET', `/api/images/${id}`);
        }

        function showImageUpdate() {
            const formsDiv = document.getElementById('images-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Update Image (Advanced)</h4>
                    <input type="text" id="updateImageId" placeholder="Image ID" required>
                    <input type="text" id="updateImageTitle" placeholder="New title">
                    <input type="file" id="updateImageFile" accept="image/*" placeholder="Replace image file (optional)">
                    <select id="updateImageFormat">
                        <option value="">Keep current format</option>
                        <option value="webp">WebP</option>
                        <option value="avif">AVIF</option>
                        <option value="jpeg">JPEG</option>
                        <option value="png">PNG</option>
                        <option value="gif">GIF</option>
                        <option value="tiff">TIFF</option>
                        <option value="bmp">BMP</option>
                    </select>
                    <textarea id="updateImageNotes" placeholder="Notes (JSON format, e.g. {&quot;description&quot;: &quot;Updated image&quot;})"></textarea>
                    <div style="margin: 10px 0;">
                        <label><input type="radio" name="updateType" value="simple" checked> Simple Update (title only)</label><br>
                        <label><input type="radio" name="updateType" value="advanced"> Advanced Update (title, format, notes)</label><br>
                        <label><input type="radio" name="updateType" value="replace"> Replace Image File (with new file)</label>
                    </div>
                    <button class="btn" onclick="updateImage()">Update Image</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        async function updateImage() {
            const id = document.getElementById('updateImageId').value;
            const title = document.getElementById('updateImageTitle').value;
            const file = document.getElementById('updateImageFile').files[0];
            const format = document.getElementById('updateImageFormat').value;
            const notes = document.getElementById('updateImageNotes').value;
            const updateType = document.querySelector('input[name="updateType"]:checked').value;
            
            if (!id) {
                alert('Please enter image ID');
                return;
            }
            
            if (updateType === 'simple') {
                // Simple update - only title
                if (!title) {
                    alert('Please enter new title for simple update');
                    return;
                }
                testRoute('PUT', `/api/images/${id}`, { title });
            } else if (updateType === 'replace') {
                // Replace image file using PUT with multipart
                if (!file) {
                    alert('Please select a new image file');
                    return;
                }
                
                const formData = new FormData();
                if (title) formData.append('title', title);
                if (format) formData.append('format', format);
                if (notes) formData.append('notes', notes);
                formData.append('image', file);
                
                try {
                    const response = await fetch(`${baseURL}/api/images/${id}`, {
                        method: 'PUT',
                        headers: { 'Authorization': `Bearer ${authToken}` },
                        body: formData
                    });
                    
                    const data = await response.json();
                    const responseDiv = document.getElementById('images-response');
                    responseDiv.innerHTML = `
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Response:</strong><br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                    responseDiv.className = `response ${response.ok ? 'success' : 'error'}`;
                    responseDiv.classList.remove('hidden');
                } catch (error) {
                    alert('Update error: ' + error.message);
                }
            } else {
                // Advanced update using PATCH endpoint
                const updateData = {};
                if (title) updateData.title = title;
                if (format) updateData.format = format;
                if (notes) {
                    try {
                        updateData.notes = JSON.parse(notes);
                    } catch (error) {
                        alert('Invalid JSON format in notes');
                        return;
                    }
                }
                
                if (Object.keys(updateData).length === 0) {
                    alert('Please provide at least one field to update');
                    return;
                }
                
                // Use PATCH for advanced updates
                testRoute('PATCH', `/api/images/${id}`, updateData);
            }
        }

        function showImageDelete() {
            const formsDiv = document.getElementById('images-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Delete Image</h4>
                    <input type="text" id="deleteImageId" placeholder="Image ID" required>
                    <button class="btn btn-danger" onclick="deleteImage()">Delete Image</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function deleteImage() {
            const id = document.getElementById('deleteImageId').value;
            if (!id) {
                alert('Please enter image ID');
                return;
            }
            if (confirm('Are you sure you want to delete this image?')) {
                testRoute('DELETE', `/api/images/${id}`);
            }
        }

        function showUserCreate() {
            const formsDiv = document.getElementById('users-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Create User</h4>
                    <input type="text" id="newUsername" placeholder="Username" required>
                    <input type="email" id="newEmail" placeholder="Email" required>
                    <input type="password" id="newPassword" placeholder="Password" required>
                    <select id="newRole">
                        <option value="viewer">Viewer</option>
                        <option value="editor">Editor</option>
                        <option value="admin">Admin</option>
                        <option value="superadmin">Super Admin</option>
                    </select>
                    <button class="btn" onclick="createUser()">Create User</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function createUser() {
            const username = document.getElementById('newUsername').value;
            const email = document.getElementById('newEmail').value;
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('newRole').value;

            if (!username || !email || !password) {
                alert('Please fill all required fields');
                return;
            }

            testRoute('POST', '/api/users', { username, email, password, role });
        }

        function showUserById() {
            const formsDiv = document.getElementById('users-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Get User by ID</h4>
                    <input type="text" id="userId" placeholder="User ID" required>
                    <button class="btn" onclick="getUserById()">Get User</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function getUserById() {
            const id = document.getElementById('userId').value;
            if (!id) {
                alert('Please enter user ID');
                return;
            }
            testRoute('GET', `/api/users/${id}`);
        }

        function showUserUpdate() {
            const formsDiv = document.getElementById('users-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Update User</h4>
                    <input type="text" id="updateUserId" placeholder="User ID" required>
                    <input type="text" id="updateUsername" placeholder="New username">
                    <input type="email" id="updateEmail" placeholder="New email">
                    <select id="updateRole">
                        <option value="">Keep current role</option>
                        <option value="viewer">Viewer</option>
                        <option value="editor">Editor</option>
                        <option value="admin">Admin</option>
                        <option value="superadmin">Super Admin</option>
                    </select>
                    <button class="btn" onclick="updateUser()">Update User</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function updateUser() {
            const id = document.getElementById('updateUserId').value;
            const username = document.getElementById('updateUsername').value;
            const email = document.getElementById('updateEmail').value;
            const role = document.getElementById('updateRole').value;

            if (!id) {
                alert('Please enter user ID');
                return;
            }

            const updateData = {};
            if (username) updateData.username = username;
            if (email) updateData.email = email;
            if (role) updateData.role = role;

            testRoute('PUT', `/api/users/${id}`, updateData);
        }

        function showUserDelete() {
            const formsDiv = document.getElementById('users-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Delete User</h4>
                    <input type="text" id="deleteUserId" placeholder="User ID" required>
                    <button class="btn btn-danger" onclick="deleteUser()">Delete User</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function deleteUser() {
            const id = document.getElementById('deleteUserId').value;
            if (!id) {
                alert('Please enter user ID');
                return;
            }
            if (confirm('Are you sure you want to delete this user?')) {
                testRoute('DELETE', `/api/users/${id}`);
            }
        }

        function showTenantCreate() {
            const formsDiv = document.getElementById('tenants-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Create Tenant</h4>
                    <input type="text" id="tenantName" placeholder="Tenant Name" required>
                    <textarea id="tenantDescription" placeholder="Description"></textarea>
                    <button class="btn" onclick="createTenant()">Create Tenant</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function createTenant() {
            const name = document.getElementById('tenantName').value;
            const description = document.getElementById('tenantDescription').value;

            if (!name) {
                alert('Please enter tenant name');
                return;
            }

            testRoute('POST', '/api/tenants', { name, description });
        }

        function showTenantById() {
            const formsDiv = document.getElementById('tenants-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Get Tenant by ID</h4>
                    <input type="text" id="tenantId" placeholder="Tenant ID" required>
                    <button class="btn" onclick="getTenantById()">Get Tenant</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function getTenantById() {
            const id = document.getElementById('tenantId').value;
            if (!id) {
                alert('Please enter tenant ID');
                return;
            }
            testRoute('GET', `/api/tenants/${id}`);
        }

        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function showFileUpload() {
            const formsDiv = document.getElementById('files-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Upload File</h4>
                    <input type="text" id="fileName" placeholder="File name" required>
                    <input type="file" id="uploadFile" required>
                    <button class="btn" onclick="uploadFile()">Upload</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        async function uploadFile() {
            const name = document.getElementById('fileName').value;
            const file = document.getElementById('uploadFile').files[0];

            if (!name || !file) {
                alert('Please provide name and select a file');
                return;
            }

            const formData = new FormData();
            formData.append('name', name);
            formData.append('file', file);

            try {
                const response = await fetch(`${baseURL}/api/files`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: formData
                });

                const data = await response.json();
                const responseDiv = document.getElementById('files-response');
                responseDiv.innerHTML = `
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Response:</strong><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                responseDiv.className = `response ${response.ok ? 'success' : 'error'}`;
                responseDiv.classList.remove('hidden');
            } catch (error) {
                alert('Upload error: ' + error.message);
            }
        }

        function showFileById() {
            const formsDiv = document.getElementById('files-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Get File by ID</h4>
                    <input type="text" id="fileId" placeholder="File ID" required>
                    <button class="btn" onclick="getFileById()">Get File</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function getFileById() {
            const id = document.getElementById('fileId').value;
            if (!id) {
                alert('Please enter file ID');
                return;
            }
            testRoute('GET', `/api/files/${id}`);
        }

        function showFileDelete() {
            const formsDiv = document.getElementById('files-forms');
            formsDiv.innerHTML = `
                <div class="test-form">
                    <h4>Delete File</h4>
                    <input type="text" id="deleteFileId" placeholder="File ID" required>
                    <button class="btn btn-danger" onclick="deleteFile()">Delete File</button>
                </div>
            `;
            formsDiv.classList.remove('hidden');
        }

        function deleteFile() {
            const id = document.getElementById('deleteFileId').value;
            if (!id) {
                alert('Please enter file ID');
                return;
            }
            if (confirm('Are you sure you want to delete this file?')) {
                testRoute('DELETE', `/api/files/${id}`);
            }
        }
    </script>
</body>
</html>